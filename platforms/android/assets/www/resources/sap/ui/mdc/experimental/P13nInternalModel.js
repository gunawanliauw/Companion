/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/ManagedObject','sap/ui/model/json/JSONModel','sap/ui/comp/personalization/Util'],function(q,M,J,P){"use strict";var c=M.extend("sap.ui.mdc.experimental.P13nInternalModel",{metadata:{properties:{initialSort:{type:"boolean",defaultValue:true},model:{type:"sap.ui.model.json.JSONModel",visibility:"hidden"}},associations:{items:{type:"sap.ui.mdc.experimental.P13nColumnItem",multiple:true}}}});c.prototype.applySettings=function(){M.prototype.applySettings.apply(this,arguments);this._initialize();};c.prototype.exit=function(){this.getModel().destroy();};c.prototype._initialize=function(){var m=this.getItems().map(function(p){if(typeof p==="string"){p=sap.ui.getCore().byId(p);}return{columnKey:p.getColumnKey(),selected:p.getSelected(),position:p.getPosition(),text:p.getText()};});this._sortBySelected(m);var o=new J({items:m});o.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);o.setSizeLimit(1000);this.setModel(o);};c.prototype.getModelItemByColumnKey=function(C){return this.getModel().getProperty("/items").find(function(m){return m.columnKey===C;});};c.prototype.getIndexOfModelItem=function(m){return this.getModel().getProperty("/items").indexOf(m);};c.prototype.selectModelItem=function(m){var a=this.getModel().getProperty("/items");var b=this._getSelectedModelItemsBetween(m,a[0]);if(b.length&&b[0].position>m.position){this.moveModelItemPosition(m,b[0]);}else{b=this._getSelectedModelItemsBetween(m,a[a.length-1]);if(b.length&&b[0].position<m.position){this.moveModelItemPosition(m,b[0]);}}};c.prototype.moveModelItem=function(m,o){if(!m||!o){return;}var a=this.getModel().getProperty("/items");var i=a.indexOf(m);var I=a.indexOf(o);if(i<0||I<0||i>a.length-1||I>a.length-1){return;}var b=a.splice(i,1)[0];a.splice(I,0,b);this.getModel().setProperty("/items",a);};c.prototype.moveModelItemPosition=function(m,o){var s=this._getSelectedModelItemsBetween(m,o);if(!s.length){return;}var d=this.getModel();var e=d.getProperty("/items");var i=e.indexOf(m);var I=e.indexOf(o);if(i<I){o=s[s.length-1];}else{o=s[s.length-1];}var f=q.extend(true,[],e);f.sort(function(a,b){if(a.position<b.position){return-1;}else if(a.position>b.position){return 1;}else{return 0;}});var g=f.splice(m.position,1)[0];f.forEach(function(a,b){a.position=b;});f.splice(o.position,0,g);f.forEach(function(a,b){a.position=b;});e.forEach(function(a,b){var h=P.getArrayElementByKey("columnKey",a.columnKey,f);d.setProperty("/items/"+b+"/position",h.position);});};c.prototype._getSelectedModelItemsBetween=function(m,o){var a=this.getModel().getProperty("/items");var i=a.indexOf(m);var I=a.indexOf(o);if(i===I){return[];}var b=[];if(i<I){b=a.slice(i+1,I+1);return b.filter(function(d){return!!d.selected;});}b=a.slice(I,i).reverse();return b.filter(function(d){return!!d.selected;});};c.prototype._sortBySelected=function(m){if(!this.getInitialSort()){return;}m.sort(function(a,b){if(a.selected===true&&(b.selected===false||b.selected===undefined)){return-1;}else if((a.selected===false||a.selected===undefined)&&b.selected===true){return 1;}else if(a.selected===true&&b.selected===true){if(a.position<b.position){return-1;}else if(a.position>b.position){return 1;}else{return 0;}}else if((a.selected===false||a.selected===undefined)&&(b.selected===false||b.selected===undefined)){if(a.text<b.text){return-1;}else if(a.text>b.text){return 1;}else{return 0;}}});};return c;},true);
