sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/mdc/experimental/provider/model/ModelAdapterFactory","sap/ui/mdc/experimental/provider/registry/ControlRegistry","sap/ui/model/json/JSONModel"],function(M,F,C,J){"use strict";var P={};P.apply=function(){M.prototype._processMetadataContexts=function(m,s){var k=Object.keys(m);for(var i=0;i<k.length;i++){var o=m[k[i]];if(!P._sanityChecks(o)){return;}this._oProviderData={};this._oProviderData.metadata=o;this._oProviderData.mProvidedProperties={};var r=o.path[0]!=='/';if(!r&&o.context){delete o.context;jQuery.sap.log.debug("Metadata context has an absolute path, ignoring the given context '"+o.context+"'");}if(r&&o.context){o.path=o.context+"/"+o.path;delete o.context;r=false;}this._oProviderData.relative=r;if(this._oProviderData){this.attachModelContextChange(P._handleModelContextChange,P);}}};M.prototype._cloneMetadataContexts=function(c){if(this._oProviderData){c._oProviderData=this._oProviderData;}};};P._handleModelContextChange=function(e){var c=e.getSource();P._driveWithMetadata(c._oProviderData,c);};P._driveWithMetadata=function(p,c){if(!p.model){p.model=c.getModel(p.metadata.model);}if(!p.model){jQuery.sap.log.debug("Metadata context cannot be resolved yet");return;}if(p.relative){var s=c.getBindingContext(p.metadata.model);if(!s){jQuery.sap.log.debug("Metadata context cannot be resolved yet");return;}else{p.metadata.path=s+"/"+p.metadata.path;delete p.relative;}}var f=C.getProviderFunction(c);if(f){F.requestAdapter(p.model,p.metadata.model,p.metadata.adapter).then(function(a){a.switchMetaContext(p.metadata.path);f(c,a);});}};P._sanityChecks=function(m){if(!m){jQuery.sap.log.warning("No metadata context available");return false;}if(typeof m=="string"){m=M.bindingParser(m);}if(!m.hasOwnProperty("path")||typeof m.path!=="string"){jQuery.sap.log.warning("Metadata context is missing a path or path is not a string");return false;}if(!m.hasOwnProperty("relative")){m.relative=!m.hasOwnProperty("context");}else if(typeof m.relative!=="boolean"){jQuery.sap.log.warning("Metadata relative information must be a boolean");return false;}if(m.hasOwnProperty("context")&&typeof m.context!=="string"){jQuery.sap.log.warning("Metadata context needs no context or a context path of type string");return false;}if(!m.hasOwnProperty("model")){m.model=undefined;jQuery.sap.log.debug("Metadata context is missing a model, assuming undefined model");}return true;};return P;});
