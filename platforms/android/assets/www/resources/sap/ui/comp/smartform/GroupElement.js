/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/Label',"sap/m/VBox","sap/m/HBox",'sap/ui/comp/library','sap/ui/core/Element','sap/ui/layout/form/FormElement','sap/ui/comp/smartfield/SmartLabel','sap/ui/comp/smartfield/SmartField','sap/m/FlexItemData','sap/ui/core/VariantLayoutData','sap/ui/layout/GridData'],function(q,L,V,H,l,E,F,S,a,b,c,G){"use strict";var d=F.extend("sap.ui.comp.smartform.GroupElement",{metadata:{library:"sap.ui.comp",properties:{useHorizontalLayout:{type:"boolean",group:"Misc",defaultValue:null},horizontalLayoutGroupElementMinWidth:{type:"int",group:"Misc",defaultValue:null},elementForLabel:{type:"int",group:"Misc",defaultValue:0}},defaultAggregation:"elements",aggregations:{elements:{type:"sap.ui.core.Control",multiple:true,singularName:"element"}},events:{visibleChanged:{}},designTime:true},_visibilityDerived:false,_bHorizontalLayoutUsed:false});d._myVBox=undefined;d.prototype._getFieldRelevantForLabel=function(){var i=this.getElements();var I=this.getElementForLabel();if(i.length>I&&(i[I]instanceof a)){return i[I];}return null;};d.prototype._extractFields=function(i,B){var C=[];i.forEach(function(D){if(D.getItems){C=C.concat(D.getItems());}else{C.push(D);}});if(C.some(function(D){return D.getItems;})){C=this._extractFields(C);}if(B){C=C.filter(function(D){return!(D instanceof sap.m.Label);});}return C;};d.prototype.setTooltip=function(T){F.prototype.setTooltip.apply(this,[T]);var R=this._getFieldRelevantForLabel();var i=this._getLabel();_.call(this,i,R);return this;};function _(i,R){if(i==this._oSetLabel){return;}var T;if(this._oSetLabel&&this._oSetLabel instanceof sap.ui.core.Control){T=A.call(this._oSetLabel);}if(!T){T=A.call(this);}if(T){if(i instanceof S){if(R&&R.setTooltipLabel){R.setTooltipLabel(T);}}else{i.setTooltip(T);}}}d.prototype.setLabel=function(i){if(!i&&this._bMoveLabelToVBox){return this.setAggregation("label",i);}if(this._oSetLabel&&(typeof this._oSetLabel!=="string")){this._oSetLabel.detachEvent("_change",e,this);}var O;var B;var C;if(typeof i==="string"){O=this._getLabel();if(O){B=O.getText();}}else if(!i&&this._oSetLabel){B=this.getLabelText();}F.prototype.setLabel.apply(this,[i]);this._oSetLabel=i;f.call(this);if(typeof i==="string"){if(this._oLabel instanceof S&&i!=B&&(i.length>0||B.length>0)){C=this._getFieldRelevantForLabel();if(C&&i!=null){if(C.getTextLabel){if(!C._oTextLabelSetByGroupElement){C._oTextLabelSetByGroupElement={oldText:C.getTextLabel()};}C.setTextLabel(i);}}}if(!this._bHorizontalLayoutUsed){this.setAggregation("_label",this._oLabel,true);}this._oLabel.isRequired=g;}else{if(i){if(i.isRequired){i.isRequired=g;}i.attachEvent("_change",e,this);}else{C=this._getFieldRelevantForLabel();if(C){y.call(this,C,B);}}this.updateLabelOfFormElement();}return this;};d.prototype.destroyLabel=function(){var O=this.getLabelText();F.prototype.destroyLabel.apply(this);delete this._oSetLabel;f.call(this);var i=this._getFieldRelevantForLabel();if(i){y.call(this,i,O);}this.updateLabelOfFormElement();return this;};function e(i){if(i.getParameter("name")=="text"){var B=i.oSource;var T=B.getText();if(this._oLabel){this._oLabel.setText(T);}var C=this._getFieldRelevantForLabel();if(C&&C.getTextLabel){if(!C._oTextLabelSetByGroupElement){C._oTextLabelSetByGroupElement={oldText:C.getTextLabel()};}C.setTextLabel(T);}}}function f(){if(!this._bHorizontalLayoutUsed){return;}var i=this.getFields();var O;if(i.length>0){var B=this.getFields()[0];if(B instanceof V){var I=B.getItems();var N=this._getLabel();if(I.length>0&&I[0]instanceof L){O=I[0];}this._bMoveLabelToVBox=true;if(O&&O!=N){B.removeItem(0);if(O._bCreatedByGroupElement){this.setAggregation("_label",O,true);}else{this.setAggregation("label",O);}}if(N&&O!=N){B.insertItem(N,0);}this._bMoveLabelToVBox=false;h.call(this);}}}function g(){if(this.getRequired&&this.getRequired()){return true;}var B=this.getParent();if(B instanceof sap.m.VBox){B=B.getParent();}var C=B.getElements();for(var i=0;i<C.length;i++){var D=C[i];if(D.getRequired&&D.getRequired()===true&&(!D.getEditable||D.getEditable())&&(!D.getContextEditable||D.getContextEditable())){return true;}}return false;}function h(){var i=this._getFieldRelevantForLabel();if(i){if(this._oLabel){this._oLabel.setLabelFor(i);}return;}var B=this.getFields();i=B.length>0?B[0]:null;if(i instanceof V){var I=i.getItems();if(I[1]instanceof H){i=I[1].getItems()[0];}else{i=I[1];}}var C=this._oLabel;if(C){C.setLabelFor(i);}else{C=this.getLabel();if(C instanceof sap.ui.core.Control){C.setAlternativeLabelFor(i);}}}d.prototype.getLabel=function(){return this._oSetLabel;};d.prototype._getLabel=function(){if(this._oLabel){return this._oLabel;}else{return this._oSetLabel;}};d.prototype.getLabelControl=function(){if(this._bHorizontalLayoutUsed){return null;}else{return this._getLabel();}};d.prototype.getLabelText=function(){var i="";var B=this._getLabel();if(B){i=B.getText();}return i;};d.prototype.setElementForLabel=function(i){this.setProperty("elementForLabel",i);this.updateLabelOfFormElement();return this;};d.prototype._createLabel=function(i){var B=null;var C=this._getFieldRelevantForLabel();if(C){if(C.getShowLabel&&C.getShowLabel()){B=new S(C.getId()+'-label');if(i){if(!C._oTextLabelSetByGroupElement){C._oTextLabelSetByGroupElement={oldText:C.getTextLabel()};}C.setTextLabel(i);B.setText(i);}B.setLabelFor(C);}}else{B=new L();B.setText(i);}if(B){B._bCreatedByGroupElement=true;B.isRequired=g;this._oLabel=B;if(!this.getUseHorizontalLayout()){this.setAggregation("_label",B,true);}}return B;};d.prototype.updateLabelOfFormElement=function(){var C=false,O=null;var i=this.getElements();var R=this._getFieldRelevantForLabel();var B=this._getLabel();var D=false;if(B&&B._bCreatedByGroupElement){if(B instanceof S){if(!R||(B._sSmartFieldId&&B._sSmartFieldId!=R.getId())){D=true;}}else if(R){D=true;}if(D){B.destroy();delete this._oLabel;B=null;if(this._oSetLabel&&!R){if(typeof this._oSetLabel==="string"){F.prototype.setLabel.apply(this,[this._oSetLabel]);B=this._oLabel;this._oLabel.isRequired=g;}else{B=this._oSetLabel;}f.call(this);}}}else if(B&&R){if(B==this._oLabel){B.destroy();delete this._oLabel;}B=null;}if(!B){if(this._oSetLabel){if(typeof this._oSetLabel==="string"){O=this._oSetLabel;}else{O=this._oSetLabel.getText();}}else{O="";}}if(!B&&i.length>0){B=this._createLabel(O);C=true;}if(B){if(B instanceof S){if(R&&R.setTextLabel&&R.getTextLabel()){B.setText(R.getTextLabel());}}_.call(this,B,R);}if(C){f.call(this);if(B&&B.setLabelFor&&!(B instanceof S)&&!R&&(i.length>0)){B.setLabelFor(i[0]);}}};d.prototype.setEditMode=function(i){var B=this.getElements();B.forEach(function(C){if(C instanceof a){if(!(C.data("editable")===false)){C.setContextEditable(i);}}});return this;};d.prototype._getVisibilityOfFields=function(B,I){var R=false;var i=0,C=0,D=null;if(B&&B.length){C=B.length;for(i=0;i<C;i++){D=B[i];if(D){if(I&&D instanceof S){continue;}if(D instanceof V){R=this._getVisibilityOfFields(this._extractFields([D]),true);}else{R=D.getVisible();}}if(R){break;}}}return R;};d.prototype._updateFormElementVisibility=function(){var i=this.getVisible();var B=false,C=null;if(i===false&&this._visibilityDerived===false){return;}C=this.getElements();if(C&&C.length){B=this._getVisibilityOfFields(C);}if(i!==B){this._visibilityDerived=true;F.prototype.setVisible.apply(this,[B]);this.fireVisibleChanged({visible:B});if(this.getParent()){this.getParent()._updateLineBreaks();}}};d.prototype._updateLayout=function(){var i=null;var B=null;var C=[];var D=[];var I=null;var U=this.getUseHorizontalLayout();var J;var K=0;var M;if(U==this._bHorizontalLayoutUsed){return;}if(this._bHorizontalLayoutUsed){D=this.getFields();C=this._extractFields(D,true);}else{C=this.getFields();}var N=this._getLabel();if(U){if(C.length>0&&C[0].getLayoutData()){I=C[0].getLayoutData();}this.removeAllFields();if(C.length>0){if(C.length>1){for(K=0;K<C.length;K++){M=C[K];if(K>0){j.call(this,M);}}B=n.call(this,C.slice(0));}if(B){J=[B];}else{J=C.slice(0);}i=m.call(this,J,N,I);this.addField(i);if(N){h.call(this);}}}else{if(D[0]instanceof V){i=D[0];J=i.getItems();if(C.length>1&&J.length>0){if(N){if(J.length>1&&J[1]instanceof H){B=J[1];}}else if(J[0]instanceof H){B=J[0];}if(B){B.removeAllItems();B.destroy();}}i.removeAllItems();i.destroy();}this.removeAllFields();for(K=0;K<C.length;K++){M=C[K];k.call(this,M);this.addField(M);}if(N){if(N==this._oLabel){this.setAggregation("_label",N,true);}else{this.setAggregation("label",N);}}}this._bHorizontalLayoutUsed=U;};function j(i){var B=i.getLayoutData();if(B){if(B.getStyleClass&&!B.getStyleClass()){B.setStyleClass("sapUiCompGroupElementHBoxPadding");}}else{B=new sap.m.FlexItemData({styleClass:"sapUiCompGroupElementHBoxPadding"});B._bCreatedByGroupElement=true;i.setLayoutData(B);}}function k(i){var B=i.getLayoutData();if(B){if(B._bCreatedByGroupElement){B.destroy();}else if(B.getStyleClass&&B.getStyleClass()=="sapUiCompGroupElementHBoxPadding"){B.setStyleClass();}}}function m(i,B,C){if(!d._myVBox){d._myVBox=V.extend("SmartFormVBox",{metadata:{interfaces:["sap.ui.core.IFormContent"]},enhanceAccessibilityState:o,renderer:"sap.m.VBoxRenderer"});}this._bMoveLabelToVBox=true;var D=i.slice(0);if(B){D.splice(0,0,B);}var I=new d._myVBox(this.getId()+"--VBox",{"items":D});this._bMoveLabelToVBox=false;I.addStyleClass("sapUiCompGroupElementVBox");I._oGroupElement=this;if(C){I.setLayoutData(C.clone());}p.call(this,I);return I;}function n(C){var i=new H(this.getId()+"--HBox",{"items":C});i._oGroupElement=this;i.enhanceAccessibilityState=o;return i;}function o(i,B){var C=this._oGroupElement._getLabel();if(C&&C!=i&&!(i instanceof H)){var D=B["labelledby"];if(!D){D=C.getId();}else{var I=D.split(" ");if(q.inArray(C.getId(),I)<0){I.splice(0,0,C.getId());D=I.join(" ");}}B["labelledby"]=D;}return B;}d.prototype._updateGridDataSpan=function(){if(!this.getUseHorizontalLayout()){return;}var i=this.getFields();if(i.length>0){var B=i[0];if(B instanceof V){p.call(this,B);}}};function p(i){var B=this.getParent();if(!B||!B.addGroupElement){return;}var C=B.getParent();while(C&&!C.addGroup&&C.getParent){C=C.getParent();}if(!C){return;}var D="";var I=C.getLayout();if(I){D=I.getGridDataSpan();}var J=i.getLayoutData();var N;if(J){if(J instanceof sap.m.FlexItemData){N=new sap.ui.layout.GridData({span:D});N._bFromGroupElement=true;var K=new sap.ui.core.VariantLayoutData({multipleLayoutData:[J,N]});K._bFromGroupElement=true;i.setLayoutData(K);}else if(J instanceof sap.ui.layout.GridData){if(!D&&J._bFromGroupElement){J.destroy();}else{J.setSpan(D);}}else if(J instanceof sap.ui.core.VariantLayoutData){J.getMultipleLayoutData().forEach(function(J){if(J instanceof sap.ui.layout.GridData){if(!D&&J._bFromGroupElement){J.destroy();}else{J.setSpan(D);}}});if(J._bFromGroupElement&&J.getMultipleLayoutData().length==1){N=J.getMultipleLayoutData()[0];i.setLayoutData(N);J.destroy();}}}else{N=new sap.ui.layout.GridData({span:D});N._bFromGroupElement=true;i.setLayoutData(N);}var M=i.getItems()[1];if(M&&M.setControlContext){M.setControlContext(sap.ui.comp.smartfield.ControlContextType.SmartFormGrid);}}d.prototype._setLinebreak=function(B,C,D,I){if(!this.getUseHorizontalLayout()){return;}var J=this.getFields();if(J.length>0){var K=J[0];if(!(K instanceof V)){return;}var M=K.getLayoutData();if(M){if(M instanceof sap.ui.core.VariantLayoutData){var N=M.getMultipleLayoutData();for(var i=0;i<N.length;i++){M=N[i];if(M.setLinebreak){M.setLinebreakXL(B);M.setLinebreakL(C);M.setLinebreakM(D);M.setLinebreakS(I);}}}else{M.setLinebreakXL(B);M.setLinebreakL(C);M.setLinebreakM(D);M.setLinebreakS(I);}}}};d.prototype.setVisible=function(i){var B,C=this.getVisible();this._visibilityDerived=false;F.prototype.setVisible.apply(this,arguments);if(i){this._updateFormElementVisibility();}B=this.getVisible();if(!i||B){if(C!=B){this.fireVisibleChanged({visible:B});}}return this;};d.prototype.setUseHorizontalLayout=function(i){var O=this.getUseHorizontalLayout();if(O==i){return this;}this.setProperty("useHorizontalLayout",i);this._updateLayout();return this;};d.prototype.setHorizontalLayoutGroupElementMinWidth=function(i){var B=this.getHorizontalLayoutGroupElementMinWidth();if(B==i){return this;}q.sap.log.error("HorizontalLayoutGroupElementMinWidth is deprecated",this);this.setProperty("horizontalLayoutGroupElementMinWidth",i);this._updateLayout();return this;};d.prototype.getFormElement=function(){return this;};d.prototype.addElement=function(i){if(!i){return this;}i=this.validateAggregation("elements",i,true);s.call(this,i);var B;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){B=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){r.call(this,i,undefined,true);}else{this.addField(i);}if(B&&B!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(B);}this.updateLabelOfFormElement();return this;};d.prototype.insertElement=function(i,I){if(!i){return this;}i=this.validateAggregation("elements",i,true);s.call(this,i);var B;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){B=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){r.call(this,i,I,false);}else{this.insertField(i,I);}if(B&&B!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(B);}this.updateLabelOfFormElement();return this;};d.prototype.getElements=function(){var i;var B;if(this.getUseHorizontalLayout()){i=this.getFields();B=this._extractFields(i,true);}else{B=this.getFields();}return B;};d.prototype.indexOfElement=function(B){var I=-1;if(this.getUseHorizontalLayout()){var C=this.getElements();for(var i=0;i<C.length;i++){if(B==C[i]){I=i;break;}}}else{I=this.indexOfField(B);}return I;};d.prototype.removeElement=function(i){var R;var B;if(this._oLabel&&this._oLabel._bCreatedByGroupElement&&this._oLabel._sSmartFieldId){B=this._oLabel._sSmartFieldId;}if(this.getUseHorizontalLayout()){R=w.call(this,i,false);}else{R=this.removeField(i);}if(R){x.call(this,R);}if(B&&B!=this._oLabel._sSmartFieldId){this._oLabel.setLabelFor(B);}this.updateLabelOfFormElement();return R;};d.prototype.removeAllElements=function(){var R;if(this.getUseHorizontalLayout()){R=w.call(this,undefined,true);}else{R=this.removeAllFields();}if(R&&Array.isArray(R)){for(var i=0;i<R.length;i++){x.call(this,R[i]);}}this.updateLabelOfFormElement();return R;};d.prototype.destroyElements=function(){if(this.getUseHorizontalLayout()){var i=this.getFields();if(i.length>0){var B=this._getLabel();if(B){i[0].removeItem(B);if(B==this._oLabel){this.setAggregation("_label",B,true);}else{this.setAggregation("label",B);}}this.destroyFields();}}else{this.destroyFields();}this.updateLabelOfFormElement();return this;};function r(i,I,B){var C=this._getLabel();var D=this.getFields();var J;var K;var M;if(D.length>0){J=D[0];}else{M=[i];var N=i.getLayoutData();J=m.call(this,M,C,N);this.addField(J);if(C){h.call(this);}return;}if(!(J instanceof V)){return;}M=J.getItems();if(C){if(M.length>1){K=M[1];}}else if(M.length>0){K=M[0];}if(K instanceof H){M=K.getItems();if((B||I>0)&&M.length>0){j.call(this,i);}if(B){K.addItem(i);}else{if(I==0&&M.length>0){j.call(this,M[0]);}K.insertItem(i,I);}}else{var O=K;M=[];if(O){J.removeItem(O);if(B||I>0){M.push(O);M.push(i);j.call(this,i);}else{M.push(i);M.push(O);j.call(this,O);}K=n.call(this,M);J.addItem(K);}else{J.addItem(i);}if(C){h.call(this);}}}function s(i){if(i.getEditable){if(!i.getEditable()){i.data("editable",false);}}if(i.attachVisibleChanged){i.attachVisibleChanged(this._updateFormElementVisibility,this);}if(i.attachInnerControlsCreated){i.attachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext(sap.ui.comp.smartfield.ControlContextType.Form);}if(i.getMetadata().getProperty("mandatory")){i.attachEvent("_change",v,this);}t.call(this,i);}function t(B){if(B instanceof a){var C=this.getCustomData();for(var i=0;i<C.length;i++){u.call(this,B,C[i]);}}}function u(i,C){if(i instanceof a&&sap.ui.comp.smartform.inheritCostomDataToFields(C)){var N=C.clone();N._bFromGroupElement=true;N._sOriginalId=C.getId();i.addCustomData(N);}}function v(i){if(i.getParameter("name")=="mandatory"){var B=this._getLabel();if(B){B.invalidate();}}}function w(B,C){var D=this._getLabel();var I=this.getFields();var J;var K;var M;var R;var N=false;var O;if(I.length>0){J=I[0];}if(!(J instanceof V)){return null;}M=J.getItems();if(D){if(M.length>1){K=M[1];}}else if(M.length>0){K=M[0];}if(K instanceof H){if(C){R=K.removeAllItems();N=true;}else{R=K.removeItem(B);M=K.getItems();if(M.length>0){k.call(this,M[0]);if(M.length==1){O=M[0];K.removeAllItems();J.removeItem(K);K.destroy();J.addItem(O);}}}}else{if(C){R=J.removeAllItems();}else{R=J.removeItem(B);}if(R){N=true;}}if(N){if(D){J.removeItem(D);if(D==this._oLabel){this.setAggregation("_label",D,true);}else{this.setAggregation("label",D);}}this.removeField(J);J.destroy();}if(R){if(Array.isArray(R)){for(var i=0;i<R.length;i++){O=R[i];k.call(this,O);}}else{k.call(this,R);}}return R;}function x(i){if(i.detachVisibleChanged){i.detachVisibleChanged(this._updateFormElementVisibility,this);}if(i.detachInnerControlsCreated){i.detachInnerControlsCreated(this._updateFormElementLabel,this);}if(i.setControlContext){i.setControlContext();}if(i.getMetadata().getProperty("mandatory")){i.detachEvent("_change",v,this);}z.call(this,i);y.call(this,i,this.getLabelText());}function y(i,B){if(i._oTextLabelSetByGroupElement){if(i.getTextLabel()==B){i.setTextLabel(i._oTextLabelSetByGroupElement.oldText);}delete i._oTextLabelSetByGroupElement;}}function z(B,O){if(B instanceof a){var C=B.getCustomData();for(var i=0;i<C.length;i++){var D=C[i];if(D._bFromGroupElement&&(!O||O==D._sOriginalId)){B.removeCustomData(D);D.destroy();}}}}d.prototype._updateFormElementLabel=function(i){var R=this._getFieldRelevantForLabel();var B=this._getLabel();var C=i.oSource;var I=i.getParameters();if(B instanceof S&&C&&I&&C===R){B.updateLabelFor(I);}};d.prototype.addCustomData=function(C){if(!C){return this;}F.prototype.addCustomData.apply(this,arguments);var B=this.getElements();for(var i=0;i<B.length;i++){u.call(this,B[i],C);}return this;};d.prototype.insertCustomData=function(C,I){if(!C){return this;}F.prototype.insertCustomData.apply(this,arguments);var B=this.getElements();for(var i=0;i<B.length;i++){u.call(this,B[i],C);}return this;};d.prototype.removeCustomData=function(C){var B=F.prototype.removeCustomData.apply(this,arguments);if(B){var D=this.getElements();for(var i=0;i<D.length;i++){z.call(this,D[i],B.getId());}}return B;};d.prototype.removeAllCustomData=function(){var C=F.prototype.removeAllCustomData.apply(this,arguments);if(C.length>0){var B=this.getElements();for(var i=0;i<B.length;i++){z.call(this,B[i]);}}return C;};d.prototype.destroyCustomData=function(){F.prototype.destroyCustomData.apply(this,arguments);var B=this.getElements();for(var i=0;i<B.length;i++){z.call(this,B[i]);}return this;};d.prototype.getVisibleBasedOnElements=function(){var i=true;var B=this.getElements();if(B&&B.length>0){i=B.some(function(C){return C.getVisible();});}return i;};function A(){var T=this.getTooltip();if(!T||typeof T==="string"||T instanceof String){return T;}else{return T.getText();}}d.prototype.clone=function(I,B){var C=this.removeAllElements();var D=F.prototype.clone.apply(this,arguments);for(var i=0;i<C.length;i++){var J=C[i];var K=J.clone(I,B);this.addElement(J);D.addElement(K);}return D;};return d;},true);
